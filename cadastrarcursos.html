<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Cursos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(180deg, #020617, #0f172a);
      color: #e5e7eb;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      background: #020617;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0,0,0,.4);
    }

    h1 {
      margin: 0 0 20px 0;
      font-size: 22px;
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .nav button {
      width: auto;
      padding: 8px 14px;
    }

    .counter {
      font-size: 14px;
      opacity: .8;
    }

    input, textarea, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
    }

    input, textarea, select {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
    }

    textarea { min-height: 80px; resize: vertical; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 24px;
    }

    .actions button {
      height: 40px;
    }


    .field {
  margin-top: 14px;
}

.field label {
  display: block;
  font-size: 13px;
  margin-bottom: 4px;
  opacity: 0.85;
}

.bottom-nav {
  margin-top: 30px;
  margin-bottom: 10px;
}

.btn-novo    { background: #16a34a; }
.btn-editar  { background: #eab308; color: #000; }
.btn-salvar  { background: #2563eb; }
.btn-login   { background: #2563eb; }

button {
  transition: transform .1s ease, box-shadow .1s ease, opacity .1s ease;
}

button:active {
  transform: scale(0.97);
  box-shadow: 0 0 0 rgba(0,0,0,0);
  opacity: 0.9;
}

button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
 

    .danger { background: #dc2626; }
    .secondary { background: #334155; }

    .hidden { display: none; }

    @media (max-width: 768px) {
      .row { grid-template-columns: 1fr; }
      .actions { flex-direction: column; }
    }

.uppercase {
  text-transform: uppercase;
}





#loadingBox {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 12px;
  text-align: center;
}

#loadingBox h1 {
  font-size: 24px;
  letter-spacing: 1px;
}

#loadingBox p {
  font-size: 14px;
  opacity: 0.7;
}

/* anima√ß√£o simples */
@keyframes pulse {
  0% { opacity: .4; }
  50% { opacity: 1; }
  100% { opacity: .4; }
}

#loadingBox p {
  animation: pulse 1.4s infinite;
}





    
  </style>
</head>

<body>

<script src="/js/igc-config.js"></script>

<div class="container">

 <!-- üìã SISTEMA --> 
<!-- üîê LOGIN -->
<div id="loginBox">
  <h1>Acesso restrito</h1>

  <div class="field">
    <label>Senha de acesso</label>
    <input type="password" id="senhaLogin">
  </div>

  <button class="btn-login" onclick="login()">Entrar</button>

  <p id="loginErro" style="color:#f87171; margin-top:10px;"></p>
</div>

<!-- ‚è≥ LOADING -->
<div id="loadingBox" class="hidden">
  <h1>IGC Treinamentos</h1>
  <p>Carregando sistema...</p>
</div>

  
<div id="appBox" class="hidden">  
  <h1>Cadastro de Cursos</h1>

  

  <!-- FORM -->
  <input type="hidden" id="cursoId">

  <div class="field">
  <label>Nome do curso</label>
  <input id="nome" disabled class="uppercase">
</div>

<div class="field">
  <label>Turma</label>
  <input id="turma" disabled class="uppercase">
</div>

<div class="row">
  <div class="field">
    <label>Carga hor√°ria</label>
    <input id="carga" disabled class="uppercase">
  </div>

  <div class="field">
    <label>Status</label>
    <select id="ativo" disabled>
      <option value="TRUE">Ativo</option>
      <option value="FALSE">Inativo</option>
    </select>
  </div>
</div>

<div class="field">
  <label>Local do curso</label>
  <input id="local" disabled class="uppercase">
</div>

<div class="field">
  <label>Data / Hor√°rio</label>
  <input id="data" disabled class="uppercase">
</div>

<div class="field">
  <label>Observa√ß√µes</label>
  <textarea id="obs" disabled class="uppercase"></textarea>
</div>

<div class="field">
  <label>ID do Modelo de Certificado</label>
  <input id="modelo" disabled>
</div>

<div class="field">
  <label>URL de Verifica√ß√£o do Certificado</label>
  <input id="urlVerificacao" disabled>
</div>


 <!-- NAVEGA√á√ÉO -->
  <div class="nav">
    <button onclick="prev()">‚óÄ</button>
    <div class="counter" id="contador">0 de 0</div>
    <button onclick="next()">‚ñ∂</button>
  </div> 

  
  <!-- A√á√ïES -->
  <div class="actions">
    <button class="btn-novo" onclick="novo()">Novo</button>
    <button class="btn-editar" onclick="editar()">Editar</button>
    <button class="btn-salvar" onclick="salvar()">Salvar</button>
    <button class="danger" onclick="excluir()">Excluir</button>
  </div>

</div>
</div>


  
  
  
<script>
const API = window.IGC_CONFIG.APPS_SCRIPT_BASE;

let SENHA = "";
let PERFIL = "";

let cursos = [];
let index = 0;
let modo = "view";



async function login() {
  const senha = document.getElementById("senhaLogin").value.trim();
  const erro = document.getElementById("loginErro");

  erro.innerText = "";

  if (!senha) {
    erro.innerText = "Informe a senha.";
    return;
  }

  const res = await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "loginCursos",
      senha: senha
    })
  }).then(r => r.json());

  if (!res.ok || res.perfil !== "ADMIN") {
    erro.innerText = "Acesso n√£o autorizado.";
    return;
  }

  // ‚úÖ LOGIN OK
  SENHA = senha;
  PERFIL = res.perfil;

  // esconde login
document.getElementById("loginBox").classList.add("hidden");

// mostra loading
document.getElementById("loadingBox").classList.remove("hidden");

// carrega dados em paralelo
carregarCursos();

// ap√≥s 2 segundos, mostra o sistema
setTimeout(() => {
  document.getElementById("loadingBox").classList.add("hidden");
  document.getElementById("appBox").classList.remove("hidden");
  bloquear(true);
}, 2000);
  
}


  
async function carregarCursos() {
  cursos = await fetch(API + "?acao=listarCursos")
    .then(r => r.json());

  if (!cursos.length) {
    contador.innerText = "0 de 0";
    return;
  }

  index = 0;
  preencher(cursos[index]);


controlarBotoes({
  novo: true,
  editar: true,
  salvar: false,
  excluir: true
});
  
}



function controlarBotoes({ novo, editar, salvar, excluir }) {
  document.querySelector(".btn-novo").disabled   = !novo;
  document.querySelector(".btn-editar").disabled = !editar;
  document.querySelector(".btn-salvar").disabled = !salvar;
  document.querySelector(".danger").disabled     = !excluir;
}

  
  
function preencher(c) {
  cursoId.value = c.id || "";
  nome.value = c.nome || "";
  turma.value = c.turma || "";
  carga.value = c.carga || "";
  local.value = c.local || "";
  data.value = c.data || "";
  obs.value = c.obs || "";
  ativo.value = c.ativo ? "TRUE" : "FALSE";
  modelo.value = c.modelo || "";
  urlVerificacao.value = c.urlVerificacao || "";

  contador.innerText = `${index + 1} de ${cursos.length}`;
}

function bloquear(b) {
  document.querySelectorAll(
    "#appBox input, #appBox textarea, #appBox select"
  ).forEach(el => el.disabled = b);
}


function prev() {
  if (index > 0) index--;
  preencher(cursos[index]);

  bloquear(true);

  controlarBotoes({
    novo: true,
    editar: true,
    salvar: false,
    excluir: true
  });
}

function next() {
  if (index < cursos.length - 1) index++;
  preencher(cursos[index]);

  bloquear(true);

  controlarBotoes({
    novo: true,
    editar: true,
    salvar: false,
    excluir: true
  });
}


function novo() {
  modo = "novo";

  cursoId.value = "";

  document.querySelectorAll(
    "#appBox input, #appBox textarea, #appBox select"
  ).forEach(el => {
    el.disabled = false;
    el.value = "";
  });

  ativo.value = "TRUE";

controlarBotoes({
    novo: false,
    editar: false,
    salvar: true,
    excluir: false
  });
  
}




  
function editar() {
  if (!cursoId.value) return;

  modo = "editar";

  document.querySelectorAll(
    "#appBox input, #appBox textarea, #appBox select"
  ).forEach(el => el.disabled = false);

  controlarBotoes({
    novo: false,
    editar: false,
    salvar: true,
    excluir: false
  });
}


function forcarCaixaAlta() {
  document.querySelectorAll(".uppercase").forEach(el => {
    el.value = el.value.toUpperCase();
  });
}


  

async function salvar() {
  
  forcarCaixaAlta();
  
  const curso = {
    id: cursoId.value || null,
    nome: nome.value,
    turma: turma.value,
    carga: carga.value,
    local: local.value,
    data: data.value,
    obs: obs.value,
    ativo: ativo.value === "TRUE",
    modelo: modelo.value,
    urlVerificacao: urlVerificacao.value
  };

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "salvarCurso",
      senha: SENHA,
      curso: curso
    })
  }).then(r => r.json());

  bloquear(true);
  carregarCursos();


  controlarBotoes({
  novo: true,
  editar: true,
  salvar: false,
  excluir: true
});
  
}

async function excluir() {
  if (!cursoId.value) return;
  if (!confirm("Excluir este curso?")) return;

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "excluirCurso",
      senha: SENHA,
      id: cursoId.value
    })
  });

  carregarCursos();
}

</script>

</body>
</html>


<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Cursos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>


    
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 16px;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(180deg, #020617, #0f172a);
  color: #e5e7eb;
}

/* ===============================
   CARD PRINCIPAL
================================ */
.container {
  max-width: 1100px;
  margin: 40px auto;
  padding: 24px;
  background: #020617;              /* üî• CARD DE VOLTA */
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,.4);
}

/* ===============================
   T√çTULOS
================================ */
h1 {
  margin: 0 0 16px 0;
  font-size: 22px;
}

/* ===============================
   CAMPOS
================================ */
input,
textarea,
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}

input,
textarea {
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
}

textarea {
  resize: vertical;
  min-height: 80px;
}

/* ===============================
   BOT√ïES
================================ */
button {
  background: #2563eb;
  color: #fff;
  cursor: pointer;
  margin-top: 16px;
  height: 40px;
  border-radius: 6px;
}

button.danger {
  background: #dc2626;
}

/* ===============================
   GRID FORM
================================ */
.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

/* ===============================
   TABELA
================================ */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 32px;
}

th, td {
  padding: 12px;
  border-bottom: 1px solid #334155;
  text-align: left;
  vertical-align: top;
  font-size: 14px;
}

th {
  background: #020617;
  font-weight: bold;
}

/* ===============================
   A√á√ïES
================================ */
.actions {
  display: flex;
  gap: 8px;
}

.actions button {
  min-width: 80px;
  height: 34px;
  font-size: 12px;
  padding: 0;
}

/* ===============================
   UTIL
================================ */
.hidden {
  display: none;
}

/* ===============================
   üì± MOBILE
================================ */
@media (max-width: 768px) {

  body {
    padding: 12px;
  }

  .container {
    margin: 0 auto;
    padding: 16px;
  }

  h1 {
    font-size: 18px;
  }

  .row {
    grid-template-columns: 1fr;
  }

  /* üî• CONT√âM A TABELA */
  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  th, td {
    font-size: 12px;
    padding: 8px;
  }

  .actions {
    flex-direction: column;
  }

  .actions button {
    width: 100%;
  }
}



    
  </style>
</head>

<body>

<script src="/js/igc-config.js"></script>

<div class="container">

  <!-- üîê LOGIN -->
  <div id="loginBox">
    <h1>Acesso restrito</h1>
    <input type="password" id="senha" placeholder="Digite a senha">
    <button onclick="login()">Entrar</button>
    <p id="loginErro" style="color:#f87171"></p>
  </div>

  <!-- üìã SISTEMA -->
  <div id="appBox" class="hidden">

    <h1>Cadastro de Cursos</h1>

    <!-- FORM -->
    <div>
      <input type="hidden" id="cursoId">

      <input id="nome" placeholder="Nome do curso">

      <div class="row">
        <input id="turma" placeholder="Turma">
        <input id="carga" placeholder="Carga hor√°ria">
      </div>

      <input id="local" placeholder="Local do curso">
      <input id="data" placeholder="Data / Hor√°rio">

      <textarea id="obs" placeholder="Observa√ß√µes"></textarea>

      <button onclick="salvar()">Salvar curso</button>
    </div>

    <!-- LISTA -->
    <table>
      <thead>
        <tr>
          <th>Curso</th>
          <th>Turma</th>
          <th>Carga</th>
          <th>Local</th>
          <th>Data</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="listaCursos"></tbody>
    </table>

  </div>

</div>

<script>
const API = window.IGC_CONFIG.APPS_SCRIPT_BASE;
let SENHA = "";

/* ===============================
   LOGIN
================================ */
async function login() {
  const senha = document.getElementById("senha").value.trim();
  if (!senha) return;

  const res = await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "loginCursos",
      senha: senha
    })
  }).then(r => r.json());

  if (!res.ok || res.perfil !== "ADMIN") {
    document.getElementById("loginErro").innerText =
      "Acesso n√£o autorizado.";
    return;
  }

  SENHA = senha;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("appBox").classList.remove("hidden");

  carregarCursos();
}

/* ===============================
   LISTAR
================================ */
async function carregarCursos() {
  const cursos = await fetch(API + "?acao=listarCursos")
    .then(r => r.json());

  const tbody = document.getElementById("listaCursos");
  tbody.innerHTML = "";

  cursos.forEach(c => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${c.nome}</td>
      <td>${c.turma || ""}</td>
      <td>${c.carga}</td>
      <td>${c.local}</td>
      <td>${c.data}</td>
      <td class="actions">
        <button onclick='editar(${JSON.stringify(c)})'>Editar</button>
        <button class="danger" onclick="excluir('${c.id}')">Excluir</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

/* ===============================
   SALVAR
================================ */
async function salvar() {
  const curso = {
    id: document.getElementById("cursoId").value,
    nome: document.getElementById("nome").value,
    turma: document.getElementById("turma").value,
    carga: document.getElementById("carga").value,
    local: document.getElementById("local").value,
    data: document.getElementById("data").value,
    obs: document.getElementById("obs").value
  };

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "salvarCurso",
      senha: SENHA,
      curso: curso
    })
  });

  limpar();
  carregarCursos();
}

/* ===============================
   EDITAR
================================ */
function editar(c) {
  document.getElementById("cursoId").value = c.id;
  document.getElementById("nome").value = c.nome;
  document.getElementById("turma").value = c.turma || "";
  document.getElementById("carga").value = c.carga;
  document.getElementById("local").value = c.local;
  document.getElementById("data").value = c.data;
  document.getElementById("obs").value = c.obs || "";
}

/* ===============================
   EXCLUIR
================================ */
async function excluir(id) {
  if (!confirm("Excluir este curso?")) return;

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      acao: "excluirCurso",
      senha: SENHA,
      id: id
    })
  });

  carregarCursos();
}

/* ===============================
   RESET FORM
================================ */
function limpar() {
  document.getElementById("cursoId").value = "";
  document.querySelectorAll("input, textarea").forEach(e => e.value = "");
}
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CRM LEADS</title>

<style>

/* ===============================
   ðŸ”¥ BASE VISUAL PROFISSIONAL
================================ */
body{
  background:#0f0f0f;
  color:#fff;
  font-family:Segoe UI, Arial;
  margin:0;
}

header{
  padding:20px;
  font-size:22px;
  font-weight:600;
  letter-spacing:1px;
  border-bottom:1px solid #222;
}

.container{
  padding:20px 30px;
}

/* ===============================
   ðŸ”¹ FORM CARD
================================ */
.card{
  background:#181818;
  padding:20px;
  border-radius:8px;
  box-shadow:0 0 10px rgba(0,0,0,.4);
  margin-bottom:20px;
}

.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

input, select, textarea{
  background:#111;
  border:1px solid #333;
  color:#fff;
  padding:8px;
  border-radius:5px;
  outline:none;
  font-size:13px;
}

input:focus, select:focus, textarea:focus{
  border:1px solid #00bfff;
}

input{
  text-transform:uppercase;
}

textarea{
  resize:none;
}

button{
  background:#00bfff;
  border:none;
  padding:9px 14px;
  border-radius:5px;
  cursor:pointer;
  font-weight:600;
  font-size:12px;
}

button:hover{
  background:#009acd;
}

.btn-secondary{
  background:#333;
}

.btn-secondary:hover{
  background:#444;
}

/* ===============================
   ðŸ”¹ TABELA CRM
================================ */
.table{
  width:100%;
  border-collapse:collapse;
}

.table th{
  background:#1e1e1e;
  padding:10px;
  text-align:left;
  font-size:12px;
  letter-spacing:.5px;
  cursor:pointer;
}

.table td{
  padding:10px;
  border-bottom:1px solid #222;
  font-size:13px;
}

.table tr:hover{
  background:#1a1a1a;
}

.status{
  padding:4px 8px;
  border-radius:12px;
  font-size:11px;
  font-weight:bold;
}

.LEAD{background:#555;}
.EM\ CONTATO{background:#0066cc;}
.NEGOCIAÃ‡ÃƒO{background:#ff9900;}
.FECHADO{background:#00aa55;}
.PERDIDO{background:#aa0000;}

.search-box{
  margin-bottom:10px;
}

</style>
</head>
<body>

<header>GESTÃƒO DE LEADS</header>

<div class="container">

<div class="card">

<div class="row">

<input id="nome" placeholder="NOME" style="width:160px">
<input id="telefone" placeholder="TELEFONE" style="width:130px">
<input id="cidade" placeholder="CIDADE" style="width:140px">
<input id="servico" placeholder="SERVIÃ‡O" style="width:140px">

<select id="status">
  <option>LEAD</option>
  <option>EM CONTATO</option>
  <option>NEGOCIAÃ‡ÃƒO</option>
  <option>FECHADO</option>
  <option>PERDIDO</option>
</select>

<input type="date" id="dataContato">
<input type="time" id="horaContato">

<textarea id="obs" placeholder="OBSERVAÃ‡Ã•ES" rows="2" style="width:220px"></textarea>

<button onclick="salvar()">SALVAR</button>
<button class="btn-secondary" onclick="limpar()">NOVO</button>

</div>
</div>

<div class="card">

<div class="search-box">
<input id="filtroNome" placeholder="BUSCAR NOME" onkeyup="render()">
</div>

<table class="table">
<thead>
<tr>
<th onclick="ordenar(3)">NOME</th>
<th onclick="ordenar(4)">TELEFONE</th>
<th onclick="ordenar(5)">CIDADE</th>
<th onclick="ordenar(7)">STATUS</th>
<th>AÃ‡Ã•ES</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

</div>

<script>

const ENDPOINT = "https://script.google.com/macros/s/AKfycbw5-8ipl32njS9C5YKp67i2eQJWDoAfrShx3p4IAtDzayVlaIyuztlNMeoF2a3-aAqf/exec";

let SENHA = "";
let dadosGlobais = [];
let ordemAsc = true;

// ===============================
// ðŸ”’ LOGIN AUTOMÃTICO
// ===============================
window.onload = function(){
  SENHA = prompt("DIGITE SUA SENHA");
  listar();
};

// ===============================
// ðŸ”¢ TELEFONE SOMENTE NÃšMERO
// ===============================
document.getElementById("telefone")
.addEventListener("input", function(){
  this.value = this.value.replace(/\D/g,'');
});

// ===============================
// ðŸ’¾ SALVAR
// ===============================
function salvar(){

  const payload = {
    nome: nome.value.toUpperCase(),
    telefone: telefone.value,
    cidade: cidade.value.toUpperCase(),
    servico: servico.value.toUpperCase(),
    status: status.value,
    dataContato: dataContato.value,
    horaContato: horaContato.value,
    observacoes: obs.value
  };

  fetch(ENDPOINT,{
    method:"POST",
    body:JSON.stringify({
      acao:"crmSalvarLead",
      senha:SENHA,
      payload
    })
  })
  .then(r=>r.json())
  .then(()=>{
    limpar();
    listar();
  });
}

// ===============================
// ðŸ“¥ LISTAR
// ===============================
function listar(){
  fetch(ENDPOINT,{
    method:"POST",
    body:JSON.stringify({
      acao:"crmListarLeads",
      senha:SENHA
    })
  })
  .then(r=>r.json())
  .then(res=>{
    dadosGlobais = res.dados || [];
    render();
  });
}

// ===============================
// ðŸŽ¨ RENDER
// ===============================
function render(){

  const filtro = filtroNome.value.toUpperCase();

  let html="";

  dadosGlobais.forEach(l=>{

    if(!l[3].includes(filtro)) return;

    html+=`
    <tr onclick="editar('${l[0]}')">
      <td>${l[3]}</td>
      <td>${l[4]}</td>
      <td>${l[5]}</td>
      <td><span class="status ${l[7]}">${l[7]}</span></td>
      <td>
        <button onclick="event.stopPropagation(); abrirWhats('${l[4]}')">ðŸ’¬</button>
      </td>
    </tr>`;
  });

  tbody.innerHTML = html;
}

// ===============================
// ðŸ“² WHATS
// ===============================
function abrirWhats(num){
  window.open("https://wa.me/55"+num,"_blank");
}

// ===============================
// ðŸ”„ ORDENAR
// ===============================
function ordenar(col){

  dadosGlobais.sort((a,b)=>{
    return ordemAsc
      ? String(a[col]).localeCompare(String(b[col]))
      : String(b[col]).localeCompare(String(a[col]));
  });

  ordemAsc = !ordemAsc;
  render();
}

// ===============================
// âœ EDITAR
// ===============================
function editar(id){

  const l = dadosGlobais.find(x=>x[0]===id);

  nome.value = l[3];
  telefone.value = l[4];
  cidade.value = l[5];
  servico.value = l[6];
  status.value = l[7];
  dataContato.value = l[1];
  horaContato.value = l[2];
}

// ===============================
function limpar(){
  document.querySelectorAll("input, textarea").forEach(e=>e.value="");
}

</script>

</body>
</html>
